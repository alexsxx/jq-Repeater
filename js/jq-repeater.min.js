/*!
 * jq-Repeater.js
 * Version: 8.7.4
 *
 * https://github.com/alexsxx/jq-Repeater
 * Copyright 2017 Alessandro Nati
 * Released under the MIT license
 */
var jqRepeater=function(){var _inst,_svdColl=[],_propsToObs=[],_isLoading=!0,_isChangingProp=!1,_und=void 0,_bName="jq-repeater",_tPrefx="jq-",_dbled="disabled",_ronly="readonly",_rqed="required",_cked="checked",_slted="selected",_shw="show",_cls="class",_hideCls="jq-hide",_inputChg="propertychange input",jqRepeater=function(a){return _hideCls=a||_hideCls,_inst=_inst||{bind:bind,update:upd,addElements:addElems,deleteElement:delEl,filterElements:filtrElems,resetFilters:resetFiltr,getCollectionElement:getColElem,setCollectionElement:setColElem,getCollection:getColObj,changePropertyValue:changePropVal,changePage:changePg}},any=function(a){return a.length>0},cont=function(a,b){return a.indexOf(b)>-1},hasProp=function(a,b){return!!a&&hasOwnProperty.call(a,b)},unesc=function(a){return a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},DOMFiltr=function(a){return a.filter(function(){var a=$(this);return typeof(a.data(_bName)||a.attr(_bName))!=typeof _und&&a.attr(_bName)!==!1&&0==a.parents().filter(function(){var a=$(this);return typeof(a.data(_bName)||a.attr(_bName))!=typeof _und&&a.attr(_bName)!==!1}).length})},bind=function(a,b){_isLoading=!0,$.each(DOMFiltr($("*")),function(c,d){var e=$(this).data(_bName)!=_und,f=!1,g=e?getsObj($(this).data(_bName).toString().substring(3)):{},h=$(d).attr(_bName),i=e?$(this).data(_bName).toString().substring(3):h.split(" in ")[1];if(hasProp(a,i)){_propsToObs=[];var j=e?g.objName:h.split(" in ")[0],k=e?g.htmlContent:unesc($(d).html()),l=e?g.pagination:{},m=e?g.filter:{},n=[];if(e)if(b==_und){g.currColl=g.collection=a[i],g.filter.collection=[],f=!0;var t=g.pagination;t!=_und&&(t._currPag=0)}else g.currColl=a[i];else{var o=$(d).attr(_tPrefx+"filter");if(o!=_und)if(cont(o,","))for(var p=o.split(","),q=0;q<p.length;q++)n.push({field:p[q].split(":")[0].trim(),control:p[q].split(":")[1]});else n.push({field:o.split(":")[0].trim(),control:o.split(":")[1]});var r=parseInt($(d).attr(_tPrefx+"pagination-rows")),s=$(d).attr(_tPrefx+"pagination-container");f=!0,_svdColl.push({cName:i,htmlContent:k,objName:j,collection:a[i],currColl:a[i],filter:m={isMultiple:JSON.parse($(d).attr(_tPrefx+"filter-multiple")||!1),controlCol:n,collection:[]},pagination:l=isNaN(r)?_und:{rowsXpage:r,container:s}})}f&&$.map(a[i],function(a,b){return a.__idx=b,a}),$(d).data(_bName,_tPrefx+i).removeAttr(_bName).empty().append(makeRepeatable(k,j,a[i],i,l,m,$(d).parent(),1)),trgEvt("Rendered",i,b||!1)}}),_isLoading=!1,trgEvt("RenderFinish")},trgEvt=function(a){$(document).trigger(a,Array.prototype.slice.call(arguments,1))},buildPgn=function(a,b,c,d){d=d||{};for(var e=d.showButtons||!0,f="javascript:;",g=function(a){return function(){changePg(c,a)}},h=$("<ul />",{class:d.class||"pagination"}).attr("data-paginator",c),i=0;i<a;i++)h.append($("<li>",{class:i+1==b?"active":""}).append($("<a>",{html:i+1,href:f,click:i+1==b?_und:g(i)})));return e&&(h.prepend($("<li>",{class:1==b?_dbled:""}).append($("<a>",{html:d.previousText||"Prev",href:f,click:1==b?_und:g(b-2)}))),h.append($("<li>",{class:b==a?_dbled:""}).append($("<a>",{html:d.nextText||"Next",href:f,click:b==a?_und:g(b)})))),h},buildFiltr=function(a,b,c,d){var e=function(c){var e=getsObj(a);e!=_und&&e.pagination!=_und&&(e.pagination._currPag=0),filtrElems(a,b,c,d)},f=$(c);f.is("select")?f.off("change").change(function(){e($(this).val())}):f.off(_inputChg).on(_inputChg,function(a){"propertychange"==a.type&&"value"!=a.originalEvent.propertyName||e($(this).val())})},recSearch=function(a,b,c,d){if(""==c||0==a.length)return a;var e=/\{[\w;\s]+\}/.test(b)?b.replace(/[\*\{\}\s]|\[\d\]/g,"").split(";"):[b],f=cont(b,"*")?Object.keys(a[0]).filter(function(a){return!cont(e,a)}):e;return $.grep(a,function(a){for(var b=0;b<f.length;b++){for(var d=f[b],e=a;cont(d,".");){var g=d.split(".");if(e=e[g[0]],g.shift(),d=g.join(""),$.isArray(e)&&any(recSearch(e,d,c)))return!0}if($.isArray(e[d])?cont(e[d],c):cont((e[d]||"").toString().toLowerCase(),c))return!0}return!1})},resetFiltr=function(a){bind(buildObj(a,getsObj(a).collection))},filtrElems=function(a,b,c,d){var e=getsObj(a),f=recSearch(e.collection,b,(c||"").toLowerCase(),0),g=e.filter.collection,h=-1;for(h=g.length-1;h>-1&&g[h].field!=b;h--);h>-1?g[h].collection=f:g.push({field:b,collection:f});var i=f;if(d)for(h=0;h<g.length;h++)g[h].field!=b&&(i=intersect(i,g[h].collection,"__idx"));bind(buildObj(a,i),!0),trgEvt("Filtered",a,i.length)},intersect=function(a,b,c){return $.grep(a,function(a){return cont($.map(b,function(a){return a[c]}),a[c])})},changePg=function(a,b){var c=getsObj(a);c.pagination!=_und&&(c.pagination._currPag=b,bind(buildObj(a,c.currColl),!0))},buildObj=function(a,b){var c={};return c[a]=b,c},makeRepeatable=function(a,b,c,d,e,f,g,h){var i=$("<div />"),j=extend([],c),k=1,l=1,m=j.length;if(e!=_und){var n=e;l=j.length/n.rowsXpage,l%1!=0&&(l=parseInt(l)+1),hasProp(n,"_currPag")?n._currPag=n._currPag>l-1?n._currPag>0?n._currPag-1:0:n._currPag:n._currPag=0,k=n._currPag+1,m=n.rowsXpage;var o=buildPgn(l,n._currPag+1,d);j=j.slice(n._currPag*n.rowsXpage,n._currPag*n.rowsXpage+n.rowsXpage);var p=$(g);n.container!=_und&&$(n.container).length>0&&(p=$(n.container)),p.find('[data-paginator="'+d+'"]').remove(),l>0&&p.append(o)}if(f!=_und)for(var q=0;q<f.controlCol.length;q++)buildFiltr(d,f.controlCol[q].field,f.controlCol[q].control,f.isMultiple);return $.each(j,function(c,e){var f=a,g=j.length,n=e.__index=k>1?(k-1)*m+c:c;$.each([_cked,_dbled,_ronly,_rqed],function(a,c){f=replVals(f,c,b,e,c+'="'+c+'"',"",n,g)}),f=f.replace(_tPrefx+_slted+'="{{',_tPrefx+_slted+'="{~{'),f=replVals(f,"",b,e,"","",n,g);var o=$("<div />").append(f);DOMFiltr(o.find("*")).each(function(){var a=$(this).attr(_bName),b=a.split(" in ")[0],d=a.split(" in ")[1],f=makeRepeatable(unesc($(this).html()).replace(/\{#/g,"{"),b,e[getPropFinalName(d)],d,_und,_und,o,c);$(this).removeAttr(_bName).empty().append(f)}),o.find("["+_tPrefx+"remove]").each(function(){var a=parseInt($(this).attr(_tPrefx+"remove"));!isNaN(a)&&a<m*(l-1)+j.length?$(this).click(function(){delEl(d,a)}):console.error("Parameter error:["+$(this).attr(_tPrefx+"remove")+"]"),$(this).removeAttr(_tPrefx+"remove")}),o.find("["+_tPrefx+"render]").each(function(){JSON.parse($(this).attr(_tPrefx+"render"))?$(this).removeAttr(_tPrefx+"render"):$(this).remove()}),o.find("["+_tPrefx+_slted+"]").each(function(){var d,a=$(this).attr(_tPrefx+_slted).replace("{~{","{{");if(cont(a,"$"+b)){var f=cleanInput(a),i=getPropFinalName(f);addObsr(f,$(this),e,(c+1)*h,_slted),d=findLegacyObj(f,e)[i]}else d=replVals(a,"",b,e,"","",n,g);setDOMObjProp(_slted,$(this),d),$(this).removeAttr(_tPrefx+_slted)}),o.find("["+_tPrefx+_cls+"]").each(function(){var a=this;$.each($(a).attr(_tPrefx+_cls).split(","),function(d,f){var g=f.split(":")[0].trim(),i=f.split(":")[1].trim();if(cont(i.toString(),"$"+b)){var j=cont(i,"_!"),k=cleanInput(i),l=getPropFinalName(k);addObsr(k,$(a),e,(c+1)*h,_cls,j,g),boolVal=Boolean(j^Boolean(findLegacyObj(k,e)[l]))}else boolVal=JSON.parse(i);setDOMObjProp(_cls,a,boolVal,g)}),$(this).removeAttr(_tPrefx+_cls)}),$.each([_shw,_dbled,_rqed,_ronly,_cked],function(a,d){addBoolVals(o,d,e,(c+1)*h,g,b)}),o.find("["+_tPrefx+"model]").each(function(){var a=cont($(this).attr(_tPrefx+"model"),"_!"),b=cleanInput($(this).attr(_tPrefx+"model")),d=getPropFinalName(b);addObsr(b,$(this),e,(c+1)*h,"model",a),$(this).unbind(),$(this).is("select")?(setDOMObjProp(_slted,$(this),findLegacyObj(b,e)[d]),$(this).change(function(){findLegacyObj(b,e)["__"+d]=$(this).find("option:"+_slted).val()})):$(this).is(":checkbox, :radio")?(setDOMObjProp(_cked,this,Boolean(a^Boolean(findLegacyObj(b,e)[d]))),$(this).change(function(){findLegacyObj(b,e)["__"+d]=Boolean(a^Boolean($(this).prop("checked")))})):$(this).is("input, textarea")?(setDOMObjProp("model",this,findLegacyObj(b,e)[d]),$(this).on(_inputChg,function(a){"propertychange"==a.type&&"value"!=a.originalEvent.propertyName||(findLegacyObj(b,e)["__"+d]=$(this).val())})):setDOMObjProp("model",this,findLegacyObj(b,e)[d]),$(this).removeAttr(_tPrefx+"model")}),i.append(o.contents())}),addWatcher(),i.contents()},evalExpr=function(exp,ind,cLen,value){exp=replBaseExpr(exp,ind,cLen);var repl="";try{if(repl=eval(exp),repl==_und)throw"Parameter error"}catch(a){console.error("Expression error["+exp+"]("+a+")")}return repl},addBoolVals=function(a,b,c,d,e,f){a.find("["+_tPrefx+b+"]").each(function(){var a=!1;if(cont($(this).attr(_tPrefx+b),"$"+f)){var g=cont($(this).attr(_tPrefx+b),"_!"),h=cleanInput($(this).attr(_tPrefx+b)),i=getPropFinalName(h);addObsr(h,$(this),c,d,b,g),a=Boolean(g^Boolean(findLegacyObj(h,c)[i]))}else a=Boolean(evalExpr($(this).attr(_tPrefx+b).replace(f,"value"),d,e,c));setDOMObjProp(b,this,a),$(this).removeAttr(_tPrefx+b)})},replBaseExpr=function(a,b,c){return a.replace(/\$index/g,b).replace(/\$last/g,b==c-1).replace(/\$first/g,0==b).replace(/\$middle/g,b==parseInt((c-1)/2)).replace(/\$even/g,b%2==0).replace(/\$odd/g,1==Math.abs(b%2))},replVals=function(a,b,c,d,e,f,g,h){var i=""!=b?_tPrefx+b+'="':"",j=""!=b?'"':"";return $.each(getMatches(new RegExp(i+"{{[a-zA-ZÀ-ú0-9&@.%$€\\-|+!?*/_,()\\[\\]=:;><'` ]+}}"+j,"g"),a),function(k,l){if(!cont(l,"$"+c)){var m=l.replace(i+"{{","").replace("}}"+j,"").replace(new RegExp(c,"g"),"value"),n="";n=""!=b?Boolean(evalExpr(m,g,h,d))?e:f:evalExpr(m,g,h,d),a=a.replace(l,n.toString())}}),a},getMatches=function(a,b){for(var c=[],d="";null!==(d=a.exec(b));)c.push(d.toString());return c},getPropFinalName=function(a){return a.split(".")[a.split(".").length-1]},cleanInput=function(a,b){return a.replace(b||"","").replace("{{","").replace("}}","").replace("$","").replace("_!","").replace('"',"")},addObsr=function(a,b,c,d,e,f,g){var h=$.grep(_propsToObs,function(b){return b.propertyName==a&&b.collectionIndex==d})[0];h!=_und?h.objsToChange.push({obj:b,type:e,isNot:f,optVal:g}):_propsToObs.push({propertyName:a,objsToChange:[{obj:b,type:e,isNot:f,optVal:g}],collectionIndex:d,value:c})},addWatcher=function(){$.each(_propsToObs,function(a,b){var c=b.propertyName.split(".")[b.propertyName.split(".").length-1],d=findLegacyObj(b.propertyName,b.value);Object.defineProperty(d,"__"+c,{set:function(a){$.each(b.objsToChange,function(b,c){setDOMObjProp(c.type,c.obj,"boolean"==typeof a?c.isNot^a:a,c.optVal)}),_isLoading||(trgEvt("ValueChanged",a,c,d,d[c],d.__index),d[c]=a),_isChangingProp&&(d[c]=a)},get:function(){return d[c]},configurable:!0})})},setDOMObjProp=function(a,b,c,d){switch(a){case _ronly:case _rqed:case _cked:case _dbled:$(b).prop(a,Boolean(c));break;case _shw:case _cls:var e=a==_shw,f=(e?1:0)^Boolean(c),g=e?_hideCls:d;f?$(b).addClass(g):$(b).removeClass(g);break;case _slted:$(b).find('option[value="'+c+'"]').prop(_slted,!0);break;case"model":$(b).is("select")?$(b).find("option[value="+c+"]").prop(_slted,!0):$(b).is(":checkbox, :radio")?$(b).prop(_cked,c):$(b).is("input, textarea")?$(b).val(c):$(b).html(c)}},changePropVal=function(a,b,c,d){_isLoading=!0,_isChangingProp=!0,pName=getPropFinalName(c),colObj=getColElem(a,b),findLegacyObj(c,colObj)["__"+pName]=d,_isLoading=!1,_isChangingProp=!1},findLegacyObj=function(a,b){var c=2==a.split(".").length;if(c)a=a.split(".")[1];else{var d=a.split(".");d.shift(),a=d.join(".")}for(var e in b){if(c&&!isObj(e)&&e==a)return b;if(!c&&isObj(b[e])&&a.split(".")[0]==e)return findLegacyObj(a,b[e])}},findProp=function(a,b){var c=2==a.split(".").length;if(c)a=a.split(".")[1];else{var d=a.split(".");d.shift(),a=d.join(".")}for(var e in b){if(c&&!isObj(e)&&e==a)return b[e];if(!c&&isObj(b[e])&&a.split(".")[0]==e)return findProp(a,b[e])}},isObj=function(a){return"object"==typeof a},extend=function(a,b){for(var c=0;c<b.length;c++)a.push(b[c]);return a},upd=function(a,b){getHtmlElem(a).empty();var c=getsObj(a),d=c.filter.collection;c.collection=b,bind(buildObj(a,$.grep(b,function(a){for(i=0;i<d.length;i++)if(!cont(d[i].collection,a))return!1;return!0})),!0),trgEvt("CollectionUpdated",a)},addElems=function(a,b){bind(buildObj(a,extend(getColObj(a),b)))},delEl=function(a,b){var c=getsObj(a),d=c.collection,e=c.pagination;d.splice(c.collection.indexOf(c.currColl[b]),1),e._currPag=e.rowsXpage*e._currPag>d.length?0:e._currPag,upd(a,d)},delPrivProps=function(a){for(var b in a)isObj(a[b])?a[b]=delPrivProps(a[b]):b.startsWith("__")&&delete a[b];return a},getColObj=function(a){var b=extend([],getsObj(a).currColl);return $.map(b,function(a){a=delPrivProps(a)}),b},getColElem=function(a,b){return getColObj(a)[b]},setColElem=function(a,b,c){getsObj(a).collection[b]=c},getHtmlElem=function(a){return $("*").filter(function(){return $(this).data(_bName)==_tPrefx+a})},getsObj=function(a){return $.grep(_svdColl,function(b){return b.cName==a})[0]};return jqRepeater}();
